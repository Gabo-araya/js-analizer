# üõ°Ô∏è NTG JavaScript & CSS Library Analyzer

Una aplicaci√≥n Python completa para **an√°lisis de seguridad web** que detecta versiones de librer√≠as JavaScript y CSS, eval√∫a vulnerabilidades de seguridad, y proporciona herramientas avanzadas de gesti√≥n y exportaci√≥n de datos a trav√©s de un dashboard web profesional con **autenticaci√≥n basada en roles** y **gesti√≥n empresarial de clientes**.

[![Security Status](https://img.shields.io/badge/Security-Audited-green)]() 
[![Python](https://img.shields.io/badge/Python-3.8+-blue)]() 
[![Flask](https://img.shields.io/badge/Flask-2.3.3-lightblue)]() 
[![License](https://img.shields.io/badge/License-Open_Source-orange)]()

## ‚ú® Caracter√≠sticas Principales

### üîê Sistema de Autenticaci√≥n y Roles
- ‚úÖ **Autenticaci√≥n segura** con hash de contrase√±as Werkzeug
- ‚úÖ **Roles de usuario**: Administrador y Analista con permisos diferenciados
- ‚úÖ **Protecci√≥n CSRF** completa en todos los formularios
- ‚úÖ **Cambio de contrase√±a propia** para todos los usuarios
- ‚úÖ **Gesti√≥n de usuarios** (solo administradores)

### üè¢ Gesti√≥n Empresarial de Clientes
- ‚úÖ **CRUD completo** de clientes empresariales
- ‚úÖ **Asignaci√≥n de escaneos** a clientes espec√≠ficos
- ‚úÖ **Filtrado por cliente** en dashboard con preservaci√≥n de contexto
- ‚úÖ **Estad√≠sticas por cliente** y reportes espec√≠ficos
- ‚úÖ **Exportaci√≥n de datos** filtrada por cliente

### üîç An√°lisis Autom√°tico
- ‚úÖ **Detecci√≥n autom√°tica** de librer√≠as JavaScript (jQuery, React, Vue.js, Angular, Bootstrap JS)
- ‚úÖ **Detecci√≥n de frameworks CSS** (Bootstrap, Font Awesome)
- ‚úÖ **An√°lisis de archivos JS/CSS** con b√∫squeda de strings de versi√≥n
- ‚úÖ **Captura de cabeceras HTTP** y an√°lisis de seguridad

### üõ°Ô∏è Evaluaci√≥n de Vulnerabilidades Mejorada
- ‚úÖ **Detecci√≥n visual de vulnerabilidades** con indicadores ‚ö†Ô∏è
- ‚úÖ **Contadores de vulnerabilidades** en listados de escaneos
- ‚úÖ **Cat√°logo global de librer√≠as** para comparaci√≥n de versiones
- ‚úÖ **An√°lisis de cabeceras de seguridad** (HSTS, CSP, X-Frame-Options, etc.)
- ‚úÖ **Puntuaci√≥n de seguridad** basada en headers presentes/ausentes

### üìä Gesti√≥n Avanzada de Librer√≠as
- ‚úÖ **Cat√°logo global** centralizado de definiciones de librer√≠as
- ‚úÖ **Agregar librer√≠as manualmente** no detectadas autom√°ticamente
- ‚úÖ **Editar informaci√≥n de librer√≠as** (descripciones, versiones seguras)
- ‚úÖ **Seguimiento de versiones** (actual, √∫ltima segura, √∫ltima disponible)
- ‚úÖ **Eliminaci√≥n individual y por lotes** con confirmaciones

### üìà Dashboard Web Profesional
- ‚úÖ **Interface moderna** con autenticaci√≥n basada en roles
- ‚úÖ **Men√∫s adaptivos** seg√∫n privilegios de usuario
- ‚úÖ **Filtrado avanzado** por cliente con preservaci√≥n de par√°metros URL
- ‚úÖ **An√°lisis desde web** (URLs individuales y por lotes)
- ‚úÖ **Operaciones batch** con checkboxes y contadores din√°micos
- ‚úÖ **Modales de confirmaci√≥n** para todas las operaciones cr√≠ticas

### üìÑ Exportaci√≥n Avanzada
- ‚úÖ **Reportes PDF** profesionales con tablas y estilos
- ‚úÖ **Exportaci√≥n CSV** completa con todas las secciones
- ‚úÖ **Libros Excel** multi-hoja con formato autom√°tico
- ‚úÖ **Exportaciones espec√≠ficas por cliente**
- ‚úÖ **Informaci√≥n de vulnerabilidades** en todos los formatos

### üîå API REST Expandida
- ‚úÖ **Endpoints completos** para acceso program√°tico
- ‚úÖ **Datos estructurados** en JSON
- ‚úÖ **Estad√≠sticas en tiempo real** del dashboard
- ‚úÖ **API de clientes** para gesti√≥n externa
- ‚úÖ **Filtrado por cliente** en endpoints API

### üìú Sistema de Historial Avanzado
- ‚úÖ **Base de datos separada** (history.db) para m√°ximo rendimiento
- ‚úÖ **Cero conflictos de concurrencia** en operaciones cr√≠ticas
- ‚úÖ **Historial completo** de todas las acciones CRUD del sistema
- ‚úÖ **Filtros avanzados** por usuario, acci√≥n, tabla, fecha y b√∫squeda libre
- ‚úÖ **Funcionalidad de deshacer** para cambios cr√≠ticos
- ‚úÖ **Exportaci√≥n de historial** en Excel, CSV y PDF
- ‚úÖ **Arquitectura escalable** con limpieza autom√°tica de registros antiguos

## üöÄ Instalaci√≥n y Despliegue

> **üê≥ RECOMENDADO: Despliegue con Podman/Docker**  
> Para producci√≥n, usa las **[üìã Instrucciones de Despliegue Completas](./DEPLOYMENT.md)**

### ‚ö° Inicio R√°pido (Desarrollo Local)

#### 1. Clonar el proyecto
```bash
git clone https://github.com/gabo-ntg/ntg-js-analyzer.git
cd ntg-js-analyzer
```

#### 2. Crear entorno virtual y instalar dependencias
```bash
python3 -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
```

#### 3. Configurar seguridad y logging (IMPORTANTE)
```bash
# Generar clave secreta segura
export FLASK_SECRET_KEY=$(openssl rand -hex 32)
# Eliminar archivo de credenciales si existe
rm -f admin_credentials.txt
# Habilitar sistema de historial con BD separada
source logging_config.sh
```

#### 4. Ejecutar aplicaci√≥n
```bash
# Con sistema de historial habilitado
source logging_config.sh && python dashboard.py
# Acceder a: http://localhost:5000
```

### üê≥ Despliegue en Producci√≥n (Recomendado)

#### Con Podman Compose
```bash
# Clonar y configurar
git clone https://github.com/gabo-ntg/ntg-js-analyzer.git
cd ntg-js-analyzer

# Configurar entorno seguro
export FLASK_SECRET_KEY=$(openssl rand -hex 32)
echo "FLASK_SECRET_KEY=$FLASK_SECRET_KEY" > .env
echo "FLASK_ENV=production" >> .env

# Desplegar
podman-compose up --build -d
```

üìã **Ver [DEPLOYMENT.md](./DEPLOYMENT.md) para instrucciones completas de producci√≥n**

## üéØ Uso

### M√©todo 1: An√°lisis Web (Recomendado)
1. **Iniciar el dashboard**:
   ```bash
   # Con sistema de historial habilitado
   source logging_config.sh && python dashboard.py
   ```

2. **Abrir navegador**: http://localhost:5000

3. **Iniciar sesi√≥n**: 
   - **Usuario por defecto**: `gabo`
   - **Contrase√±a por defecto**: `admin123`
   - **Rol**: Administrador (acceso completo)

4. **Gesti√≥n de usuarios** (solo administradores):
   - Crear usuarios con rol Administrador o Analista
   - Cambiar roles de usuarios existentes
   - Cambiar contrase√±as de otros usuarios
   - Eliminar usuarios del sistema

5. **Gesti√≥n de clientes**:
   - Crear, editar y eliminar clientes empresariales
   - Asignar escaneos a clientes espec√≠ficos
   - Filtrar an√°lisis por cliente en el dashboard

6. **Opciones de an√°lisis**:
   - **URL Individual**: Bot√≥n "‚ûï Analizar URL"
   - **An√°lisis por lotes**: Bot√≥n "üìù An√°lisis Masivo" (multiple URLs, una por l√≠nea)
   - **Asignaci√≥n de cliente**: Seleccionar cliente al crear escaneos
   - **Soporte para comentarios**: L√≠neas que empiecen con # son ignoradas

### M√©todo 2: An√°lisis por L√≠nea de Comandos
1. **Configurar URLs** en `urls.txt`:
   ```
   https://getbootstrap.com
   https://jquery.com
   https://reactjs.org
   # Este es un comentario
   https://vuejs.org
   ```

2. **Ejecutar an√°lisis**:
   ```bash
   # üÜï Usando CLI modular
   python cli.py analyze --urls-file urls.txt --delay 1.0
   
   # M√©todo antiguo (a√∫n funciona)
   python scripts/analyzer_cli.py
   ```

### üîß Gesti√≥n Manual de Librer√≠as

#### Agregar Librer√≠a Manual
1. En "Scan Details", click **"‚ûï Add Manual Library"**
2. Completar formulario:
   - **Nombre** (requerido)
   - **Tipo**: JavaScript o CSS
   - **Versi√≥n actual** encontrada en el sitio
   - **√öltima versi√≥n segura** (para detecci√≥n de vulnerabilidades)
   - **√öltima versi√≥n disponible**
   - **Descripci√≥n** opcional

#### Editar Librer√≠as
- Click **‚úèÔ∏è** en cualquier librer√≠a (auto-detectada o manual)
- Modificar campos necesarios
- **Guardar cambios**

#### Detecci√≥n de Vulnerabilidades
El sistema muestra **‚ö†Ô∏è badges rojos** cuando:
- Existe una versi√≥n segura conocida **Y**
- La versi√≥n actual es **diferente** a la segura **Y** 
- La versi√≥n actual es **menor** que la segura

## üìä Secciones del Dashboard

### P√°gina Principal
- **Autenticaci√≥n y roles**: Men√∫ de usuario con rol visible y cambio de contrase√±a
- **Estad√≠sticas generales**: Total de an√°lisis, librer√≠as, archivos, clientes
- **Estad√≠sticas adicionales**: Cat√°logo global, cobertura, actividad reciente
- **Filtros avanzados**: Por cliente con preservaci√≥n de contexto
- **An√°lisis recientes**: √öltimos escaneos con contadores de vulnerabilidades
- **Herramientas**: An√°lisis individual, por lotes, reset de BD

### Historial de Acciones (`/historial`) - Nuevo
- **Base de datos independiente**: Sistema de historial con BD separada para m√°ximo rendimiento
- **Registro completo**: Todas las acciones CRUD (crear, actualizar, eliminar) del sistema
- **Filtros avanzados**: Por usuario, tipo de acci√≥n, tabla, rango de fechas y b√∫squeda libre
- **Funcionalidad de deshacer**: Revertir cambios cr√≠ticos con validaci√≥n de integridad
- **Exportaci√≥n completa**: Excel, CSV y PDF con historial filtrado
- **Rendimiento optimizado**: Cero conflictos con operaciones de an√°lisis principales

### Gesti√≥n de Usuarios (`/users`) - Solo Administradores
- **Lista de usuarios**: Con roles y acciones disponibles
- **Crear usuarios**: Formulario con selecci√≥n de rol (Administrador/Analista)
- **Cambiar contrase√±as**: Reset de contrase√±as de otros usuarios
- **Cambiar roles**: Modificar permisos de usuarios existentes
- **Eliminar usuarios**: Con confirmaci√≥n y validaciones de seguridad

### Gesti√≥n de Clientes (`/clients`)
- **Lista de clientes**: Con estad√≠sticas y estado activo
- **CRUD completo**: Crear, editar, eliminar clientes empresariales
- **Estad√≠sticas por cliente**: Contadores de escaneos y an√°lisis
- **Filtrado**: B√∫squeda y organizaci√≥n de clientes

### Cat√°logo Global (`/global-libraries`)
- **Definiciones centralizadas**: Librer√≠as con versiones seguras conocidas
- **Gesti√≥n completa**: Agregar, editar, eliminar definiciones
- **M√©tricas de cobertura**: Estad√≠sticas del cat√°logo vs detecciones

### Detalles de An√°lisis (`/scan/<id>`)
1. **üìã Informaci√≥n del Scan**: URL, t√≠tulo, estado, fecha, cliente asignado, contadores
2. **üìö Librer√≠as Detectadas**: Con indicadores de vulnerabilidades mejorados y acciones
3. **üìÅ Archivos JS/CSS**: Todos los archivos encontrados con tama√±os y estados
4. **üîç Version Strings**: L√≠neas de c√≥digo que contienen "version" o "versi√≥n"
5. **üåê Cabeceras HTTP**: Headers completos de la respuesta
6. **üõ°Ô∏è An√°lisis de Seguridad**: Headers presentes/faltantes con puntuaci√≥n

### üìä Exportaciones
Acceder via **"üìä Export Report"** dropdown:

#### PDF Report
- **Contenido**: Informaci√≥n completa en formato profesional
- **Incluye**: Tablas con librer√≠as, an√°lisis de seguridad, datos t√©cnicos
- **Formato**: Tablas estilizadas, indicadores de vulnerabilidades

#### CSV Export  
- **Contenido**: Todos los datos en formato estructurado
- **Secciones**: Scan info, librer√≠as, archivos, version strings, headers
- **Formato**: Separado por secciones con headers claros

#### Excel Workbook
- **6 hojas separadas**:
  1. **Scan Overview**: Resumen general
  2. **Libraries**: Librer√≠as con vulnerabilidades
  3. **Security Analysis**: Headers de seguridad
  4. **JS CSS Files**: Archivos encontrados
  5. **Version Strings**: Strings de versi√≥n
  6. **HTTP Headers**: Headers completos
- **Formato profesional**: Colores, auto-ajuste de columnas, headers estilizados

## üóÇÔ∏è Estructura del Proyecto (Modularizada v3.0)

### üÜï Estructura Modular del Proyecto
```
ntg-js-analyzer/
‚îú‚îÄ‚îÄ app/                   # üì¶ Paquete principal modularizado
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       # Factory Flask con blueprints
‚îÇ   ‚îú‚îÄ‚îÄ models/           # Modelos de datos ORM-style
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scan.py       # Modelo de escaneos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ library.py    # Modelo de librer√≠as
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py       # Modelo de usuarios
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.py     # Modelo de clientes
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ history.py    # Modelo de historial
‚îÇ   ‚îú‚îÄ‚îÄ services/         # Servicios de l√≥gica de negocio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ analyzer_service.py    # Servicio de an√°lisis
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ security_analyzer.py   # An√°lisis de seguridad
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ export_service.py      # Exportaciones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ history_manager.py     # Gesti√≥n de historial
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ library_detector.py    # Detecci√≥n de librer√≠as
‚îÇ   ‚îú‚îÄ‚îÄ views/            # Blueprints organizados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py       # Autenticaci√≥n
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py       # Dashboard principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scans.py      # Gesti√≥n de escaneos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.py        # Endpoints API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exports.py    # Exportaciones
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ clients.py    # Gesti√≥n de clientes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ users.py      # Gesti√≥n de usuarios
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ history.py    # Historial de acciones
‚îÇ   ‚îú‚îÄ‚îÄ static/           # Assets est√°ticos
‚îÇ   ‚îú‚îÄ‚îÄ templates/        # Templates HTML
‚îÇ   ‚îî‚îÄ‚îÄ utils/            # Utilidades y decoradores
‚îú‚îÄ‚îÄ config/               # Configuraci√≥n centralizada
‚îÇ   ‚îú‚îÄ‚îÄ config.py         # Config por entornos
‚îÇ   ‚îî‚îÄ‚îÄ security_config.py # Config de seguridad
‚îú‚îÄ‚îÄ scripts/              # Scripts de utilidad
‚îÇ   ‚îú‚îÄ‚îÄ analyzer_cli.py   # Analizador CLI
‚îÇ   ‚îî‚îÄ‚îÄ migrate_history.py # Migraci√≥n de historial
‚îú‚îÄ‚îÄ data/                 # Bases de datos
‚îÇ   ‚îú‚îÄ‚îÄ analysis.db       # BD principal
‚îÇ   ‚îî‚îÄ‚îÄ history.db        # BD historial separada
‚îú‚îÄ‚îÄ cli.py                # üÜï CLI principal unificado
‚îú‚îÄ‚îÄ wsgi.py               # üÜï Punto de entrada WSGI
‚îú‚îÄ‚îÄ setup.py              # üÜï Instalaci√≥n como paquete
‚îú‚îÄ‚îÄ requirements.txt           # Dependencias Python
‚îú‚îÄ‚îÄ urls.txt                   # URLs para an√°lisis por lotes
‚îú‚îÄ‚îÄ logging_config.sh          # Configuraci√≥n del sistema de historial (NUEVO)
‚îú‚îÄ‚îÄ analysis.db                # Base de datos principal SQLite (auto-creada)
‚îú‚îÄ‚îÄ history.db                 # Base de datos de historial separada (NUEVO)
‚îú‚îÄ‚îÄ static/                    # Archivos est√°ticos (Flask)
‚îÇ   ‚îú‚îÄ‚îÄ css/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.css          # Estilos principales
‚îÇ   ‚îî‚îÄ‚îÄ js/
‚îÇ       ‚îú‚îÄ‚îÄ index.js          # JavaScript dashboard
‚îÇ       ‚îî‚îÄ‚îÄ scan_detail.js    # JavaScript scan details
‚îú‚îÄ‚îÄ templates/                 # Templates HTML (espa√±ol chileno)
‚îÇ   ‚îú‚îÄ‚îÄ base.html             # Template base con autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ index.html            # Dashboard con filtros de cliente
‚îÇ   ‚îú‚îÄ‚îÄ scan_detail.html      # Detalles de an√°lisis
‚îÇ   ‚îú‚îÄ‚îÄ historial.html        # Interfaz de historial de acciones (ACTUALIZADO)
‚îÇ   ‚îú‚îÄ‚îÄ login.html            # P√°gina de autenticaci√≥n
‚îÇ   ‚îú‚îÄ‚îÄ users.html            # Gesti√≥n de usuarios (admin)
‚îÇ   ‚îú‚îÄ‚îÄ clients.html          # Gesti√≥n de clientes
‚îÇ   ‚îî‚îÄ‚îÄ global_libraries.html # Cat√°logo global de librer√≠as
‚îú‚îÄ‚îÄ CLAUDE.md                  # Documentaci√≥n t√©cnica (ingl√©s)
‚îú‚îÄ‚îÄ CLAUDE_es.md              # Documentaci√≥n t√©cnica (espa√±ol)
‚îú‚îÄ‚îÄ PRD_es.md                 # Documento de requerimientos
‚îú‚îÄ‚îÄ BD_SEPARADA_COMPLETADA.md # Documentaci√≥n de implementaci√≥n (NUEVO)
‚îî‚îÄ‚îÄ README.md                  # Este archivo
```

## üõ†Ô∏è Operaciones Avanzadas

### Operaciones por Lotes
- **Selecci√≥n multiple**: Checkboxes en todas las tablas
- **"Select All"**: Checkbox en header para seleccionar todos
- **Contadores din√°micos**: "Delete Selected (X)" aparece autom√°ticamente
- **Confirmaci√≥n con preview**: Modal muestra elementos a eliminar

### Eliminaci√≥n Individual
- **Botones üóëÔ∏è**: En cada fila de las tablas
- **Confirmaci√≥n**: Modal con detalles del elemento
- **Coexistencia**: No interfiere con operaciones por lotes

### Gesti√≥n de Base de Datos
- **Arquitectura dual**: `analysis.db` (principal) + `history.db` (historial separado)
- **Reset completo**: Elimina archivo de BD y recrea esquema
- **Migraci√≥n autom√°tica**: Actualiza esquema existente sin p√©rdida de datos
- **Eliminaci√≥n cascada**: Eliminar scan borra todos los datos relacionados
- **Migraci√≥n de historial**: Script autom√°tico para migrar datos existentes

### Sistema de Historial
- **Configuraci√≥n**: Activar con `source logging_config.sh`
- **Performance**: Cero conflictos de BD durante an√°lisis masivos
- **Migraci√≥n**: Comando `python scripts/migrate_history.py` para datos existentes
- **Limpieza**: Mantenimiento autom√°tico de registros antiguos

## üì° API Endpoints

### Informaci√≥n General
- `GET /api/scans` - Lista todos los an√°lisis con contadores y filtros por cliente
- `GET /api/stats` - Estad√≠sticas del dashboard con filtros opcionales por cliente

### Gesti√≥n de Clientes
- `GET /api/clients` - Lista todos los clientes activos
- **Filtrado**: Par√°metro `client_id` disponible en endpoints de an√°lisis

### Datos Espec√≠ficos
- `GET /api/libraries` - Todas las librer√≠as con contexto del sitio
- `GET /api/version-strings` - Todos los strings de versi√≥n encontrados
- `GET /api/global-libraries` - Cat√°logo global de definiciones de librer√≠as

### Historial de Acciones (Nuevo)
- `GET /historial` - Interfaz web de historial con filtros avanzados
- `GET /historial/details/<id>` - Detalles completos de una acci√≥n espec√≠fica
- `POST /historial/undo/<id>` - Deshacer una acci√≥n (con validaciones de integridad)
- `GET /historial/export` - Exportar historial filtrado (Excel/CSV/PDF)

### Detalles de An√°lisis
- `GET /scan/<id>` - Vista completa de an√°lisis espec√≠fico (HTML)

### Ejemplos de Uso
```bash
# Estad√≠sticas generales
curl http://localhost:5000/api/stats

# Estad√≠sticas filtradas por cliente
curl http://localhost:5000/api/stats?client_id=1

# Escaneos de un cliente espec√≠fico
curl http://localhost:5000/api/scans?client_id=1

# Lista de clientes
curl http://localhost:5000/api/clients
```

## üîß Base de Datos

### Esquema Actualizado - Arquitectura Dual

#### Base de Datos Principal (`analysis.db`) - 7 tablas

#### Tabla `scans`
```sql
id, url, scan_date, status_code, title, headers (JSON), client_id (FK)
```

#### Tabla `libraries` 
```sql
id, scan_id, library_name, version, type, source_url,
description, latest_safe_version, latest_version, is_manual
```

#### Tabla `version_strings`
```sql
id, scan_id, file_url, file_type, line_number, 
line_content, version_keyword
```

#### Tabla `file_urls`
```sql
id, scan_id, file_url, file_type, file_size, status_code
```

#### Tabla `users` (Nueva)
```sql
id, username, password (hash), role ('admin'|'analyst')
```

#### Tabla `clients` (Nueva)
```sql
id, name, contact_info, is_active, created_date
```

#### Tabla `global_libraries` (Nueva)
```sql
id, library_name, description, latest_safe_version, 
latest_version, library_type
```

#### Base de Datos de Historial (`history.db`) - Separada para Performance
```sql
-- Tabla principal de historial (optimizada para concurrencia)
action_history: id, timestamp, username, user_role, action_type, 
                target_table, target_id, target_description, 
                data_before (JSON), data_after (JSON), success, 
                error_message, ip_address, user_agent, session_id, notes

-- Metadatos de auditor√≠a
audit_metadata: id, created_at, schema_version, last_cleanup, 
                 total_records, notes

-- 6 √≠ndices especializados para consultas r√°pidas
√çndices: timestamp, user_action, table_action, session, target, success
```

**Ventajas de la Arquitectura Dual:**
- ‚úÖ **Cero conflictos** durante an√°lisis masivos de URLs
- ‚úÖ **Performance optimizada** para operaciones principales
- ‚úÖ **Historial completo** sin impacto en rendimiento
- ‚úÖ **Escalabilidad** independiente de cada base de datos

## üé® Personalizaci√≥n

### Agregar Detecci√≥n de Nuevas Librer√≠as
En `analyzer.py`, extender las funciones de detecci√≥n:

```python
# Ejemplo: Detectar Lodash
lodash_scripts = soup.find_all('script', src=re.compile(r'lodash', re.I))
for script in lodash_scripts:
    src = script.get('src', '')
    version_match = re.search(r'lodash[-.]?(\d+\.\d+\.\d+)', src, re.I)
    if version_match:
        libraries.append({
            'name': 'Lodash',
            'version': version_match.group(1),
            'type': 'js',
            'source': urljoin(base_url, src)
        })
```

### Personalizar Headers de Seguridad
En `dashboard.py`, funci√≥n `analyze_security_headers()`:

```python
security_headers = {
    'custom-security-header': {
        'name': 'Custom-Security-Header',
        'description': 'Descripci√≥n del header',
        'recommendation': 'valor-recomendado'
    }
}
```

### Configurar Puerto del Servidor
```python
# En dashboard.py, l√≠nea final:
app.run(debug=True, host='0.0.0.0', port=8080)
```

## üîç Librer√≠as Detectadas

### JavaScript
- **jQuery** - Todas las versiones
- **React** - Framework de Facebook
- **Vue.js** - Framework progresivo
- **Angular** - Framework de Google
- **Bootstrap JavaScript** - Componentes JS

### CSS
- **Bootstrap CSS** - Framework de estilos
- **Font Awesome** - Librer√≠a de iconos

## üÜò Soluci√≥n de Problemas

### Error: "database is locked" (Resuelto)
```bash
# ‚úÖ SOLUCIONADO con BD separada para historial
# El sistema ahora usa history.db independiente
source logging_config.sh  # Habilitar BD separada
python dashboard.py        # Sistema sin conflictos
```

### Migrar historial existente
```bash
# Migrar datos de analysis.db a history.db
python scripts/migrate_history.py  # Una sola vez
```

### Error: "no such column: description"
```bash
# La aplicaci√≥n migra autom√°ticamente, pero si hay problemas:
rm analysis.db  # Eliminar BD existente
python dashboard.py  # Recrear con nuevo esquema
```

### Timeouts en URLs
```python
# En analyzer.py, ajustar timeout:
response = requests.get(url, headers=headers, timeout=30)
```

### Memoria para listas grandes
```python
# En analyzer.py, aumentar delay:
analyzer.analyze_urls(urls, delay=3)  # 3 segundos entre requests
```

### Puerto ocupado
```bash
# Verificar puertos en uso:
lsof -i :5000
# Cambiar puerto en dashboard.py o terminar proceso
```

### Archivos est√°ticos no cargan
```bash
# Verificar estructura:
ls -la static/css/ static/js/
# Deben existir main.css, index.js, scan_detail.js
```

## üîí Caracter√≠sticas de Seguridad

### üõ°Ô∏è Protecciones Implementadas
- ‚úÖ **Autenticaci√≥n robusta** con hash de contrase√±as Werkzeug
- ‚úÖ **Control de acceso basado en roles** (Administrador/Analista)
- ‚úÖ **Protecci√≥n CSRF** completa con Flask-WTF en todos los formularios
- ‚úÖ **Prevenci√≥n SQL Injection** con consultas parametrizadas exclusivamente
- ‚úÖ **Protecci√≥n SSRF** con validaci√≥n avanzada de URLs y bloqueo de IPs privadas
- ‚úÖ **Headers de seguridad** comprehensivos aplicados autom√°ticamente
- ‚úÖ **Configuraci√≥n segura** por defecto con gesti√≥n de sesiones segura
- ‚úÖ **Gesti√≥n de contrase√±as** con autoservicio para todos los usuarios

### üìä Headers de Seguridad Analizados
| Header | Prop√≥sito | Estado |
|--------|-----------|--------|
| **Strict-Transport-Security** | HSTS/SSL forzado | ‚úÖ Implementado |
| **Content-Security-Policy** | Control de recursos | ‚úÖ Implementado |
| **X-Frame-Options** | Anti-clickjacking | ‚úÖ Implementado |
| **X-XSS-Protection** | Protecci√≥n XSS | ‚úÖ Implementado |
| **X-Content-Type-Options** | Anti-MIME sniffing | ‚úÖ Implementado |
| **Referrer-Policy** | Control de referrer | ‚úÖ Implementado |
| **Permissions-Policy** | Control de features | ‚úÖ Implementado |

### üìà Puntuaci√≥n de Seguridad
- **üü¢ 80%+**: Excelente seguridad
- **üü° 50-79%**: Seguridad moderada  
- **üî¥ <50%**: Mejoras necesarias

### ‚ö†Ô∏è Consideraciones de Seguridad
> **IMPORTANTE**: Antes de desplegar en producci√≥n:
> - Cambiar `FLASK_SECRET_KEY` por una clave fuerte generada
> - Eliminar `admin_credentials.txt` si existe  
> - Configurar `FLASK_ENV=production` y `FLASK_DEBUG=0`
> - Cambiar credenciales por defecto del usuario `gabo`
> - Crear usuarios con contrase√±as fuertes para producci√≥n
> - Usar HTTPS con certificados v√°lidos
> - Configurar firewall para acceso controlado

## üìù Licencia

Este proyecto es de c√≥digo abierto. Puedes usarlo, modificarlo y distribuirlo libremente para fines educativos y comerciales.

## ü§ù Contribuciones

Las contribuciones son bienvenidas:
1. Fork el proyecto
2. Crea una rama para tu feature
3. Commit tus cambios
4. Push a la rama
5. Abre un Pull Request

---

## üìö Documentaci√≥n Adicional

- **[üìã Instrucciones de Despliegue](./DEPLOYMENT.md)** - Gu√≠a completa para producci√≥n con Podman
- **[üîß Documentaci√≥n T√©cnica EN](./CLAUDE.md)** - Arquitectura y desarrollo (ingl√©s)
- **[üîß Documentaci√≥n T√©cnica ES](./CLAUDE_es.md)** - Arquitectura y desarrollo (espa√±ol)
- **[üìã Documento de Requerimientos](./PRD_es.md)** - PRD completo en espa√±ol chileno
- **[üóÇÔ∏è BD Separada - Implementaci√≥n](./BD_SEPARADA_COMPLETADA.md)** - Sistema de historial con BD independiente
- **[üêõ Reportar Issues](https://github.com/gabo-ntg/ntg-js-analyzer/issues)** - Problemas y sugerencias

## üÜò Soporte

**¬øNecesitas ayuda?**
1. Revisa la [documentaci√≥n de despliegue](./DEPLOYMENT.md)
2. Consulta la [documentaci√≥n t√©cnica](./CLAUDE.md)
3. Abre un [issue en GitHub](https://github.com/gabo-ntg/ntg-js-analyzer/issues)

## üè∑Ô∏è Versi√≥n y Estado

- **Versi√≥n**: 3.0.0 (Arquitectura Modular)
- **Estado**: Producci√≥n estable con arquitectura Flask moderna
- **√öltima auditor√≠a de seguridad**: Enero 2025
- **Reorganizaci√≥n**: Estructura modularizada siguiendo convenciones Flask/Python
- **Nuevas funcionalidades**: BD de historial separada, cero conflictos de concurrencia
- **Arquitectura**: Dual database (analysis.db + history.db)
- **Python**: 3.8+ requerido
- **Flask**: 2.3.3 con Flask-WTF para CSRF
- **Interfaz**: Completamente traducida a espa√±ol chileno